<p>Received</p>

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous">
</script>

<script>
    var accessToken = '';
    var userId = '';
    
    //this bit grabs the access token out of the url, which returned from the authorization in spotify_auth
    if(window.location.hash)
    {
        var hash = window.location.hash.substring(1);
        var params = {}
        //this is some crazy JS wizard shit I found on stackoverflow
        hash.split('&').map(hk => {
          let temp = hk.split('='); 
            params[temp[0]] = temp[1] 
        });
    }
    accessToken = params.access_token;
    
    //first AJAX call grabs the user's id
    $.ajax({
       url: 'https://api.spotify.com/v1/me',
       headers: {
           'Authorization': 'Bearer ' + accessToken
       },
       success: function(response) {
            userId = response["id"];
            alert("User ID " + userId + " retrieved.");
            
            var playlistId = '';
            
            //second AJAX call grabs the ID of the playlist 'Test Playlist', if it exists
            $.ajax({
               url: 'https://api.spotify.com/v1/users/' + userId + '/playlists',
               headers: {
                   'Authorization': 'Bearer ' + accessToken
               },
               success: function(response) {
                    for(playlist in response.items)
                    {
                        if(response.items[playlist]["name"] == "Test Playlist")
                        {
                            playlistId = response.items[playlist]["id"];
                            alert("'Test Playlist' with ID " + playlistId + " found in user data.");
                        }
                    }
                    
                    if(playlistId != '')
                    {
                    
                        var trackId = 'spotify:track:6rPO02ozF3bM7NnOV4h6s2'; //deeeespaaaacito
                        
                        //POST request that adds the track specified by trackId to the 'Test Playlist'
                        $.post({
                            url: 'https://api.spotify.com/v1/users/' + userId + '/playlists/' + playlistId + '/tracks?uris=' + trackId,
                            headers: {
                                'Authorization': 'Bearer ' + accessToken
                            },
                            success: function(response) {
                                alert("Song added.");
                            },
                            //error code if POST fails
                            error: function(xhr, status, error) {
                                alert(xhr.responseText);
                            }
                        });
                        
                    }
               }
            });
            
       }
    });
    
    
</script>